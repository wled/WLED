const fs = require('fs');
const path = require('path');

// Diccionario de traducciones mejorado
const dictionary = {
  'main': 'principal',
  'setup': 'configuración',
  'loop': 'bucle',
  'initialize': 'inicializar',
  'update': 'actualizar',
  'render': 'renderizar',
  'draw': 'dibujar',
  'paint': 'pintar',
  'clear': 'limpiar',
  'reset': 'restablecer',
  'enable': 'habilitar',
  'disable': 'deshabilitar',
  'start': 'iniciar',
  'stop': 'detener',
  'pause': 'pausar',
  'resume': 'reanudar',
  'save': 'guardar',
  'load': 'cargar',
  'delete': 'eliminar',
  'create': 'crear',
  'destroy': 'destruir',
  'allocate': 'asignar',
  'deallocate': 'desasignar',
  'check': 'verificar',
  'validate': 'validar',
  'convert': 'convertir',
  'parse': 'analizar',
  'format': 'formato',
  'configure': 'configurar',
  'connect': 'conectar',
  'disconnect': 'desconectar',
  'send': 'enviar',
  'receive': 'recibir',
  'read': 'leer',
  'write': 'escribir',
  'append': 'añadir',
  'prepend': 'anteponer',
  'insert': 'insertar',
  'remove': 'eliminar',
  'replace': 'reemplazar',
  'swap': 'intercambiar',
  'sort': 'ordenar',
  'reverse': 'invertir',
  'rotate': 'rotar',
  'shift': 'desplazar',
  'push': 'empujar',
  'pop': 'extraer',
  'peek': 'mirar',
  'map': 'mapear',
  'filter': 'filtrar',
  'reduce': 'reducir',
  'fold': 'plegar',
  'scan': 'escanear',
  'search': 'buscar',
  'find': 'encontrar',
  'locate': 'localizar',
  'match': 'coincidir',
  'compare': 'comparar',
  'equal': 'igual',
  'greater': 'mayor',
  'less': 'menor',
  'minimum': 'mínimo',
  'maximum': 'máximo',
  'average': 'promedio',
  'sum': 'suma',
  'count': 'conteo',
  'index': 'índice',
  'offset': 'desplazamiento',
  'position': 'posición',
  'location': 'ubicación',
  'address': 'dirección',
  'pointer': 'puntero',
  'reference': 'referencia',
  'value': 'valor',
  'variable': 'variable',
  'constant': 'constante',
  'parameter': 'parámetro',
  'argument': 'argumento',
  'return': 'retorno',
  'result': 'resultado',
  'error': 'error',
  'warning': 'advertencia',
  'info': 'información',
  'debug': 'depuración',
  'trace': 'rastreo',
  'log': 'registro',
  'print': 'imprimir',
  'output': 'salida',
  'input': 'entrada',
  'buffer': 'búfer',
  'array': 'matriz',
  'list': 'lista',
  'queue': 'cola',
  'stack': 'pila',
  'tree': 'árbol',
  'graph': 'gráfico',
  'node': 'nodo',
  'edge': 'arista',
  'link': 'enlace',
  'connection': 'conexión',
  'network': 'red',
  'server': 'servidor',
  'client': 'cliente',
  'request': 'solicitud',
  'response': 'respuesta',
  'status': 'estado',
  'state': 'estado',
  'code': 'código',
  'message': 'mensaje',
  'data': 'datos',
  'payload': 'carga útil',
  'header': 'encabezado',
  'footer': 'pie de página',
  'body': 'cuerpo',
  'content': 'contenido',
  'text': 'texto',
  'html': 'HTML',
  'xml': 'XML',
  'json': 'JSON',
  'css': 'CSS',
  'javascript': 'JavaScript',
  'function': 'función',
  'method': 'método',
  'procedure': 'procedimiento',
  'routine': 'rutina',
  'handler': 'manejador',
  'listener': 'escuchador',
  'callback': 'devolución de llamada',
  'event': 'evento',
  'trigger': 'disparador',
  'action': 'acción',
  'effect': 'efecto',
  'animation': 'animación',
  'transition': 'transición',
  'color': 'color',
  'brightness': 'brillo',
  'intensity': 'intensidad',
  'speed': 'velocidad',
  'duration': 'duración',
  'delay': 'retraso',
  'timeout': 'tiempo de espera',
  'interval': 'intervalo',
  'frequency': 'frecuencia',
  'period': 'período',
  'cycle': 'ciclo',
  'frame': 'fotograma',
  'pixel': 'píxel',
  'led': 'LED',
  'strip': 'tira',
  'segment': 'segmento',
  'range': 'rango',
  'boundary': 'límite',
  'limit': 'límite',
  'threshold': 'umbral',
  'tolerance': 'tolerancia',
  'precision': 'precisión',
  'accuracy': 'precisión',
  'performance': 'rendimiento',
  'optimization': 'optimización',
  'memory': 'memoria',
  'storage': 'almacenamiento',
  'cache': 'caché',
  'heap': 'montón',
  'stack': 'pila',
  'thread': 'hilo',
  'process': 'proceso',
  'task': 'tarea',
  'job': 'trabajo',
  'queue': 'cola',
  'scheduler': 'planificador',
  'timer': 'temporizador',
  'interrupt': 'interrupción',
  'signal': 'señal',
  'handler': 'manejador',
  'trap': 'trampa',
  'exception': 'excepción',
  'fault': 'fallo',
  'panic': 'pánico',
  'crash': 'bloqueo',
  'freeze': 'congelación',
  'hang': 'cuelgue',
  'deadlock': 'bloqueo mutuo',
  'race': 'condición de carrera',
  'condition': 'condición',
  'mutex': 'mutex',
  'semaphore': 'semáforo',
  'lock': 'bloqueo',
  'unlock': 'desbloqueo',
  'atomic': 'atómico',
  'volatile': 'volátil',
  'synchronized': 'sincronizado',
  'asynchronous': 'asíncrono',
  'synchronous': 'síncrono',
  'blocking': 'bloqueante',
  'non-blocking': 'no bloqueante',
  'promise': 'promesa',
  'future': 'futuro',
  'await': 'esperar',
  'async': 'asíncrono',
  'generator': 'generador',
  'iterator': 'iterador',
  'enumeration': 'enumeración',
  'flag': 'bandera',
  'bit': 'bit',
  'byte': 'byte',
  'word': 'palabra',
  'integer': 'entero',
  'float': 'flotante',
  'double': 'doble',
  'string': 'cadena',
  'character': 'carácter',
  'boolean': 'booleano',
  'true': 'verdadero',
  'false': 'falso',
  'null': 'nulo',
  'undefined': 'indefinido',
  'nan': 'NaN',
  'infinity': 'infinito',
  'overflow': 'desbordamiento',
  'underflow': 'subdesbordamiento',
  'truncate': 'truncar',
  'round': 'redondear',
  'ceil': 'techo',
  'floor': 'piso',
  'absolute': 'absoluto',
  'sign': 'signo',
  'magnitude': 'magnitud',
  'scale': 'escala',
  'normalize': 'normalizar',
  'denormalize': 'desnormalizar',
  'quantize': 'cuantizar',
  'dither': 'difuminación',
  'interpolate': 'interpolar',
  'extrapolate': 'extrapolar',
  'blend': 'mezcla',
  'combine': 'combinar',
  'merge': 'fusionar',
  'split': 'dividir',
  'chunk': 'fragmento',
  'segment': 'segmento',
  'partition': 'partición',
  'distribute': 'distribuir',
  'balance': 'equilibrio',
  'load': 'carga',
  'capacity': 'capacidad',
  'utilization': 'utilización',
  'efficiency': 'eficiencia',
  'latency': 'latencia',
  'throughput': 'rendimiento',
  'bandwidth': 'ancho de banda',
  'jitter': 'inestabilidad',
  'skew': 'sesgo',
  'bias': 'sesgo',
  'variance': 'varianza',
  'deviation': 'desviación',
  'standard': 'estándar',
  'specification': 'especificación',
  'requirement': 'requisito',
  'constraint': 'restricción',
  'dependency': 'dependencia',
  'relationship': 'relación',
  'association': 'asociación',
  'aggregation': 'agregación',
  'composition': 'composición',
  'inheritance': 'herencia',
  'polymorphism': 'polimorfismo',
  'abstraction': 'abstracción',
  'encapsulation': 'encapsulamiento',
  'interface': 'interfaz',
  'implementation': 'implementación',
  'contract': 'contrato',
  'protocol': 'protocolo',
  'api': 'API',
  'sdk': 'SDK',
  'framework': 'marco de trabajo',
  'library': 'biblioteca',
  'module': 'módulo',
  'package': 'paquete',
  'component': 'componente',
  'subsystem': 'subsistema',
  'system': 'sistema',
  'platform': 'plataforma',
  'application': 'aplicación',
  'service': 'servicio',
  'middleware': 'middleware',
  'layer': 'capa',
  'tier': 'nivel',
  'level': 'nivel',
  'hierarchy': 'jerarquía',
  'topology': 'topología',
  'architecture': 'arquitectura',
  'design': 'diseño',
  'pattern': 'patrón',
  'template': 'plantilla',
  'strategy': 'estrategia',
  'algorithm': 'algoritmo',
  'heuristic': 'heurística',
  'approximation': 'aproximación',
  'estimation': 'estimación',
  'calculation': 'cálculo',
  'computation': 'computación',
  'evaluation': 'evaluación',
  'assessment': 'evaluación',
  'analysis': 'análisis',
  'synthesis': 'síntesis',
  'modeling': 'modelado',
  'simulation': 'simulación',
  'emulation': 'emulación',
  'virtualization': 'virtualización',
  'containerization': 'containerización',
  'deployment': 'implementación',
  'installation': 'instalación',
  'configuration': 'configuración',
  'customization': 'personalización',
  'extension': 'extensión',
  'plugin': 'complemento',
  'addon': 'complemento',
  'usermod': 'usermod',
  'firmware': 'firmware',
  'bootloader': 'bootloader',
  'kernel': 'kernel',
  'driver': 'controlador',
  'device': 'dispositivo',
  'hardware': 'hardware',
  'software': 'software',
  'interface': 'interfaz',
  'port': 'puerto',
  'socket': 'socket',
  'endpoint': 'extremo',
  'gateway': 'puerta de enlace',
  'proxy': 'proxy',
  'router': 'enrutador',
  'switch': 'conmutador',
  'firewall': 'cortafuegos',
  'encryption': 'cifrado',
  'decryption': 'descifrado',
  'hash': 'hash',
  'digest': 'resumen',
  'signature': 'firma',
  'certificate': 'certificado',
  'authentication': 'autenticación',
  'authorization': 'autorización',
  'access': 'acceso',
  'permission': 'permiso',
  'privilege': 'privilegio',
  'role': 'rol',
  'user': 'usuario',
  'admin': 'administrador',
  'owner': 'propietario',
  'group': 'grupo',
  'domain': 'dominio',
  'realm': 'reino',
  'zone': 'zona',
  'context': 'contexto',
  'scope': 'alcance',
  'namespace': 'espacio de nombres',
  'module': 'módulo',
  'package': 'paquete',
  'version': 'versión',
  'release': 'lanzamiento',
  'build': 'compilación',
  'patch': 'parche',
  'update': 'actualización',
  'upgrade': 'mejora',
  'downgrade': 'degradación',
  'migration': 'migración',
  'rollback': 'reversión',
  'commit': 'confirmación',
  'revert': 'revertir',
  'merge': 'fusión',
  'branch': 'rama',
  'tag': 'etiqueta',
  'cherry-pick': 'seleccionar',
  'rebase': 'cambiar base',
  'squash': 'comprimir',
  'stash': 'almacenar',
  'index': 'índice',
  'staging': 'área de preparación',
  'working': 'funcionamiento',
  'repository': 'repositorio',
  'fork': 'bifurcación',
  'clone': 'clon',
  'pull': 'extraer',
  'push': 'enviar',
  'fetch': 'obtener',
  'sync': 'sincronizar',
  'conflict': 'conflicto',
  'resolution': 'resolución',
  'diff': 'diferencia',
  'patch': 'parche',
  'blame': 'culpa',
  'history': 'historial',
  'log': 'registro',
  'stats': 'estadísticas',
  'metric': 'métrica',
  'benchmark': 'punto de referencia',
  'profile': 'perfil',
  'trace': 'rastreo',
  'breakpoint': 'punto de ruptura',
  'watchpoint': 'punto de observación',
  'step': 'paso',
  'continue': 'continuar',
  'break': 'ruptura',
  'exit': 'salida',
  'quit': 'salir',
  'abort': 'abortar',
  'retry': 'reintentar',
  'skip': 'omitir',
  'ignore': 'ignorar',
  'suppress': 'suprimir',
  'filter': 'filtro',
  'regex': 'expresión regular',
  'pattern': 'patrón',
  'wildcard': 'comodín',
  'glob': 'glob',
  'path': 'ruta',
  'directory': 'directorio',
  'folder': 'carpeta',
  'file': 'archivo',
  'extension': 'extensión',
  'permission': 'permiso',
  'owner': 'propietario',
  'group': 'grupo',
  'mode': 'modo',
  'attribute': 'atributo',
  'property': 'propiedad',
  'field': 'campo',
  'member': 'miembro',
  'static': 'estático',
  'instance': 'instancia',
  'class': 'clase',
  'struct': 'estructura',
  'union': 'unión',
  'enum': 'enumeración',
  'typedef': 'definición de tipo',
  'macro': 'macro',
  'define': 'definir',
  'ifdef': 'si está definido',
  'ifndef': 'si no está definido',
  'endif': 'fin si',
  'include': 'incluir',
  'import': 'importar',
  'export': 'exportar',
  'namespace': 'espacio de nombres',
  'using': 'usando',
  'extern': 'externo',
  'static': 'estático',
  'const': 'constante',
  'volatile': 'volátil',
  'mutable': 'mutable',
  'inline': 'en línea',
  'virtual': 'virtual',
  'override': 'anular',
  'final': 'final',
  'operator': 'operador',
  'overload': 'sobrecarga',
  'template': 'plantilla',
  'typename': 'nombre de tipo',
  'specialization': 'especialización',
  'instantiation': 'instanciación',
  'generic': 'genérico',
  'type': 'tipo',
  'cast': 'conversión',
  'coercion': 'coerción',
  'conversion': 'conversión',
  'promotion': 'promoción',
  'demotion': 'degradación',
  'widening': 'ampliación',
  'narrowing': 'reducción',
};

// Traducir un comentario
function translateComment(text) {
  let result = text;
  Object.entries(dictionary).forEach(([en, es]) => {
    const regex = new RegExp(`\\b${en}\\b`, 'gi');
    result = result.replace(regex, (match) => {
      return match[0].toUpperCase() === match[0] ? es.charAt(0).toUpperCase() + es.slice(1) : es;
    });
  });
  return result;
}

// Procesar archivo
function processFile(filePath) {
  const ext = path.extname(filePath).toLowerCase();
  if (!['.cpp', '.h', '.js', '.html', '.css', '.md', '.txt'].includes(ext)) {
    return { processed: false, translated: false };
  }

  try {
    let content = fs.readFileSync(filePath, 'utf-8');
    const original = content;

    // Comentarios de bloque /* */
    content = content.replace(/\/\*([\s\S]*?)\*\//g, (match) => {
      return '/*' + translateComment(coincidir.slice(2, -2)) + '*/';
    });

    // Comentarios de línea //
    content = content.replace(/^(\s*)\/\/(.*)$/gm, (match, indent, comment) => {
      return indent + '//' + translateComment(comment);
    });

    // Comentarios HTML <!-- -->
    content = content.replace(/<!--([\s\S]*?)-->/g, (match) => {
      return '<!--' + translateComment(coincidir.slice(4, -3)) + '-->';
    });

    const translated = content !== original;
    if (translated) {
      fs.writeFileSync(filePath, content, 'utf-8');
    }

    return { processed: true, translated };
  } catch (error) {
    console.error(`Error processing ${filePath}:`, error.message);
    return { processed: false, translated: false };
  }
}

// Escanear directorio
function scanDirectory(dir) {
  const files = [];
  const excluded = ['node_modules', '.git', '.next', 'dist', 'build', 'coverage'];
  
  try {
    const items = fs.readdirSync(dir);
    items.forEach(item => {
      const filePath = path.join(dir, item);
      const stat = fs.statSync(filePath);
      
      if (stat.isDirectory()) {
        if (!excluded.some(e => filePath.includes(e))) {
          files.push(...scanDirectory(filePath));
        }
      } else {
        files.push(filePath);
      }
    });
  } catch (error) {
    console.error(`Error scanning ${dir}:`, error.message);
  }
  
  return files;
}

// Principal
console.log('Escaneando archivos para traducir...\n');
const files = scanDirectory('/workspaces/WLED');

let totalProcessed = 0;
let totalTranslated = 0;

files.forEach(file => {
  const result = processFile(file);
  if (result.processed) {
    totalProcessed++;
    if (result.translated) {
      totalTranslated++;
      console.log(`✓ ${file}`);
    }
  }
});

console.log(`\n✓ Proceso completado`);
console.log(`  Archivos procesados: ${totalProcessed}`);
console.log(`  Archivos traducidos: ${totalTranslated}`);
